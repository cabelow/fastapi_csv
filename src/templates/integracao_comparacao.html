<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Compara√ß√£o BTP x AYZ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { margin-top: 40px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px; font-size: 14px; }
        th { background: #f0f0f0; }

        .ok { color: green; font-weight: bold; }
        .erro { color: red; font-weight: bold; }
        .warn { color: orange; font-weight: bold; }

        .status-aceito { background-color: #e6ffe6; }
        .status-divergente { background-color: #ffe6e6; }

        .cpf-header {
            margin-top: 30px;
            font-weight: bold;
            background: #fafafa;
            padding: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

<h1>Integra√ß√£o BTP √ó AYZ</h1>

<h2>üìä Resumo</h2>
<ul>
    <li>Total BTP: {{ resultado.resumo.total_btp }}</li>
    <li>Total AYZ: {{ resultado.resumo.total_ayz }}</li>
    <li class="ok">Matches exatos: {{ resultado.resumo.matches_exatos }}</li>
    <li class="warn">Matches sem√¢nticos: {{ resultado.resumo.matches_semanticos }}</li>
    <li class="erro">Diverg√™ncias reais: {{ resultado.resumo.divergencias_reais }}</li>
    <li class="erro">N√£o encontrados: {{ resultado.resumo.nao_encontrados }}</li>
</ul>

<hr>

<h2>‚úÖ Matches exatos</h2>
<table>
    <tr>
        <th>CPF</th>
        <th>BTP ID</th>
        <th>AYZ ID</th>
    </tr>
    {% for item in resultado.matches_exatos %}
    <tr>
        <td>{{ item.cpf }}</td>
        <td>{{ item.btp_id }}</td>
        <td>{{ item.ayz_id }}</td>
    </tr>
    {% else %}
    <tr>
        <td colspan="3">Nenhum match exato encontrado</td>
    </tr>
    {% endfor %}
</table>

<h2>üß† Matches sem√¢nticos (IA)</h2>

{% for item in resultado.matches_semanticos %}
    <div class="cpf-header">
        CPF {{ item.cpf }} | BTP: {{ item.btp_id }} | AYZ: {{ item.ayz_id }}
    </div>

    <table>
        <tr>
            <th>Campo</th>
            <th>BTP</th>
            <th>AYZ</th>
            <th>Status</th>
            <th>Score</th>
        </tr>

        {% for campo, valores in item.divergencias.items() %}
        <tr class="status-aceito">
            <td>{{ campo }}</td>
            <td>{{ valores.btp }}</td>
            <td>{{ valores.ayz }}</td>
            <td>
                <span class="ok">Aceito semanticamente</span>
            </td>
            <td>{{ "%.3f"|format(valores.score) }}</td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>Nenhum match sem√¢ntico encontrado.</p>
{% endfor %}


<h2>‚ö†Ô∏è Diverg√™ncias reais</h2>

{% for item in resultado.divergencias_reais %}
    <div class="cpf-header">
        CPF {{ item.cpf }} | BTP: {{ item.btp_id }} | AYZ: {{ item.ayz_id }}
    </div>

    <table>
        <tr>
            <th>Campo</th>
            <th>BTP</th>
            <th>AYZ</th>
            <th>Status</th>
            <th>Score</th>
        </tr>

        {% for campo, valores in item.divergencias.items() %}
        <tr class="{% if valores.status == 'aceito_semanticamente' %}status-aceito{% else %}status-divergente{% endif %}">
            <td>{{ campo }}</td>
            <td>{{ valores.btp }}</td>
            <td>{{ valores.ayz }}</td>
            <td>
                {% if valores.status == 'aceito_semanticamente' %}
                    <span class="ok">Aceito semanticamente</span>
                {% else %}
                    <span class="erro">Divergente</span>
                {% endif %}
            </td>
            <td>{{ "%.3f"|format(valores.score) }}</td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>Nenhuma diverg√™ncia encontrada.</p>
{% endfor %}

<h2>‚ùå N√£o encontrados no AYZ</h2>
<table>
    <tr>
        <th>CPF</th>
        <th>BTP ID</th>
    </tr>
    {% for item in resultado.nao_encontrados %}
    <tr>
        <td>{{ item.cpf }}</td>
        <td>{{ item.btp_id }}</td>
    </tr>
    {% else %}
    <tr>
        <td colspan="2">Nenhum registro ausente</td>
    </tr>
    {% endfor %}
</table>

</body>
</html>
